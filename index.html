#include <iostream>
#include <fstream>
#include <windows.h>

using namespace std;

struct StudentRecord {
    string studentName;
    int grade1;
    int grade2;
    int grade3;
    int grade4;
} student;

int main() {
    setlocale(LC_ALL, "rus");
    const char* pathAnswerFile = "C:/Users/s0177102/source/repos/file/ANSWER.bin";
    const char* pathRequestFile = "C:/Users/s0177102/source/repos/file/REQUEST.bin";

    ofstream answerFileStream;
    ifstream requestFileStream;
    fstream studentFileStream;

    while (true) {
        cout << "Введите имя студента:" << endl;
        cin >> student.studentName;

        cout << "Введите 4 оценки:" << endl;
        cin >> student.grade1 >> student.grade2 >> student.grade3 >> student.grade4;

        // Создаваем путь для файла студента
        string filename = "C:/Users/s0177102/source/repos/file/" + student.studentName + ".bin";
        const char* studentFileName = filename.c_str();

        // Запись данных в файл студента
        answerFileStream.open(studentFileName, ios::app | ios::binary);
        answerFileStream.write((char*)&student, sizeof(student));
        answerFileStream.close();

        // Запись имени в файл запросов
        requestFileStream.open(pathRequestFile, ios::app | ios::binary);
        requestFileStream.write((char*)&student.studentName, sizeof(student.studentName));
        requestFileStream.close();

        // Открытие файла студента для чтения
        studentFileStream.open(studentFileName, ios::binary);
        studentFileStream.seekg(0, ios::end);
        long previousSize = studentFileStream.tellg();
        studentFileStream.seekg(0, ios::beg);

        // Ожидание появления новых данных
        while (true) {
            Sleep(100);
            studentFileStream.seekg(0, ios::end);
            if (studentFileStream.tellg() > previousSize) {
                break;
            }
        }
        studentFileStream.seekg(previousSize, ios::beg);
        int responseCode;
        studentFileStream.read((char*)&responseCode, sizeof(responseCode));
        studentFileStream.close();

        switch (responseCode) {
            case 0:
                cout << "Обучающийся отчислен" << endl;
                break;
            case 1:
                cout << "Нет стипендии" << endl;
                break;
            case 2:
                cout << "Есть стипендия" << endl;
                break;
            case 3:
                cout << "Повышенная стипендия" << endl;
                break;
            default:
                cout << "Неизвестный ответ" << endl;
        }
    }
}
                                                 
    #include <iostream>
#include <fstream>
#include <windows.h>

using namespace std;

struct StudentData {
    string name;
    int grade1;
    int grade2;
    int grade3;
    int grade4;
} studentInfo;

int main() {
    setlocale(LC_ALL, "rus");
    const char* requestFilePath = "C:/Users/s0177102/source/repos/file/REQUEST.bin";
    const char* answerFilePath = "C:/Users/s0177102/source/repos/file/ANSWER.bin";

    ifstream requestStream;
    ofstream answerStream;
    ifstream studentFile;

    long prevSizeName = 0;

    cout << "Сервер запущен и работает..." << endl;

    // Начальное определение размера файла запросов
    requestStream.open(requestFilePath, ios::binary);
    requestStream.seekg(0, ios::end);
    prevSizeName = requestStream.tellg();
    requestStream.close();

    while (true) {
        // Ожидание появления новых запросов
        requestStream.open(requestFilePath, ios::binary);
        requestStream.seekg(0, ios::end);
        while (prevSizeName >= requestStream.tellg()) {
            Sleep(100);
            requestStream.seekg(0, ios::end);
        }
        requestStream.seekg(prevSizeName, ios::beg);
        requestStream.read((char*)&studentInfo.name, sizeof(studentInfo.name));
        prevSizeName = requestStream.tellg();
        requestStream.close();

        // Формируем путь к файлу студента
        string filename = "C:/Users/s0177102/source/repos/file/" + studentInfo.name + ".bin";
        const char* studentFileName = filename.c_str();

        // Открываем файл студента
        studentFile.open(studentFileName, ios::binary);
        studentFile.seekg(0, ios::beg);
        studentFile.read((char*)&studentInfo, sizeof(studentInfo));
        studentFile.close();

        int marks[4] = {studentInfo.grade1, studentInfo.grade2, studentInfo.grade3, studentInfo.grade4};
        int sumMarks = 0;
        int responseCode = -1;

        // Анализ оценок
        for (int i = 0; i < 4; ++i) {
            if (marks[i] == 2)
                responseCode = 0; // отчислен
            if (marks[i] == 3)
                responseCode = 1; // нет стипендии
            sumMarks += marks[i];
        }

        // Выставляем ответ в зависимости от суммы
        if (sumMarks == 20)
            responseCode = 3; // повышенная стипендия
        else if (responseCode == -1)
            responseCode = 2; // есть стипендия

        // Отправка ответа обратно клиенту
        answerStream.open(studentFileName, ios::binary | ios::app);
        answerStream.write((char*)&responseCode, sizeof(responseCode));
        answerStream.close();

        cout << "Обработка завершена, ответ отправлен клиенту." << endl;
    }
}                                             
