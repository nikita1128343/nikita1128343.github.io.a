#include <iostream>
#include <fstream>
#include <windows.h>
using namespace std;

struct ClientInfo
{
    char surname[25];  // фамилия
    int h;             // рост
    int w;             // вес
} UserData;

int main() {
    setlocale(LC_ALL, "rus");

    const char* reqFile = "C:/Users/Admin/source/repos/client/REQUEST.bin";
    const char* ansFile = "C:/Users/Admin/source/repos/client/ANSWER.bin";

    ofstream outReq;
    ifstream inAns;
    long lastSize = 0;
    int res;

    outReq.open(reqFile, ios::binary | ios::app);
    outReq.close();

    inAns.open(ansFile, ios::binary | ios::app);
    inAns.close();

    while (true)
    {
        cout << "Введите данные: Фамилия Рост Вес" << endl;
        cin >> UserData.surname >> UserData.h >> UserData.w;
        cout << UserData.surname << " " << UserData.h << " " << UserData.w << endl;

        outReq.open(reqFile, ios::app | ios::binary);
        if (!outReq.is_open()) {
            cout << "Не удалось открыть файл запросов!" << endl;
            continue;
        }
        outReq.write((char*)&UserData, sizeof(UserData));
        outReq.close();

        inAns.open(ansFile, ios::binary);
        inAns.seekg(0, ios::end);
        lastSize = inAns.tellg();
        inAns.close();

        bool gotAnswer = false;
        while (!gotAnswer)
        {
            Sleep(100);
            inAns.open(ansFile, ios::binary);
            if (!inAns.is_open()) {
                cout << "Не удалось открыть файл ответов!" << endl;
                continue;
            }

            inAns.seekg(0, ios::end);
            long currSize = inAns.tellg();

            if (currSize > lastSize)
            {
                inAns.seekg(lastSize, ios::beg);
                inAns.read((char*)&res, sizeof(res));
                gotAnswer = true;
            }
            inAns.close();
        }

        switch (res) {
        case 0:
            cout << "Дефицит массы тела\n";
            break;
        case 1:
            cout << "Вес в норме\n";
            break;
        case 2:
            cout << "Избыточная масса тела\n";
            break;
        default:
            cout << "Некорректный ответ сервера: " << res << endl;
        }
        cout << "========================================" << endl;
    }
    return 0;
}
#include <iostream>
#include <fstream>
#include <windows.h>
using namespace std;

struct ClientRequest
{
    char lastName[25];
    int heightVal;
    int weightVal;
} CurrentRequest;

int result;
long filePos = 0;

int main() {
    ifstream inFile;
    ofstream outFile;
    setlocale(LC_ALL, "rus");

    const char* inputFile = "C:/Users/Admin/source/repos/client/REQUEST.bin";
    const char* outputFile = "C:/Users/Admin/source/repos/client/ANSWER.bin";

    cout << "сервер запущен" << endl;

    outFile.open(outputFile, ios::binary | ios::app);
    outFile.close();

    inFile.open(inputFile, ios::binary | ios::app);
    inFile.close();

    inFile.open(inputFile, ios::binary);
    inFile.seekg(0, ios::end);
    filePos = inFile.tellg();
    inFile.close();

    while (true)
    {
        inFile.open(inputFile, ios::binary);
        if (!inFile.is_open()) {
            cout << "Ошибка открытия входного файла!" << endl;
            Sleep(1000);
            continue;
        }

        inFile.seekg(0, ios::end);

        while (filePos >= inFile.tellg())
        {
            inFile.close();
            Sleep(100);
            inFile.open(inputFile, ios::binary);
            inFile.seekg(0, ios::end);
        }

        inFile.seekg(filePos, ios::beg);
        inFile.read((char*)&CurrentRequest, sizeof(CurrentRequest));
        filePos = inFile.tellg();
        inFile.close();

        double heightMeters = CurrentRequest.heightVal * 0.01;
        double bmi = CurrentRequest.weightVal / (heightMeters * heightMeters);

        if (bmi < 18.5)
            result = 0;
        else if (bmi < 25)
            result = 1;
        else
            result = 2;

        outFile.open(outputFile, ios::binary | ios::app);
        if (!outFile.is_open()) {
            cout << "Ошибка открытия выходного файла!" << endl;
            continue;
        }
        outFile.write((char*)&result, sizeof(result));
        outFile.close();

        cout << "Обработан клиент: " << CurrentRequest.lastName
            << " (рост: " << CurrentRequest.heightVal
            << ", вес: " << CurrentRequest.weightVal
            << ") - код результата: " << result << endl;
    }
    return 0;
}                                                                
